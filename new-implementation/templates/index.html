<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Import HTML Table</title>
        <style>
            .selected-row {
                background-color: green;
            }
        </style>
        <script>
            var chosenObject = null;
            const linkClick = function (event) {
            };
            const rowClick = (event) => {
                console.log("You clicked a row!");
                var selectedRow =
                    document.getElementsByClassName("selected-row")[0];
                if (selectedRow && selectedRow !== event.target.parentElement) {
                    selectedRow.classList.remove("selected-row");
                }
                if (
                    event.target.parentElement.classList.contains(
                        "selected-row"
                    )
                ) {
                    event.target.parentElement.classList.remove("selected-row");
                    document.getElementById("top-div").innerHTML = "";
                    chosenObject = null;
                } else {
                    event.target.parentElement.classList.add("selected-row");
                    var rowData =
                        event.target.parentElement.getElementsByTagName("td");
                    var header = Array.from(
                        document
                            .getElementById("header")
                            .getElementsByTagName("th")
                    );

                    header = header.splice(1, header.length);


                    const result = header.reduce((acc, key, index) => {
                        acc[key.textContent] = rowData[index].textContent;
                        return acc;
                    }, {});
                    chosenObject = result;
                    console.log(chosenObject);

                }
            };
            const submitRow = async (link_path) => {
                if (chosenObject === null && document.getElementById("chosenData").innerHTML.length <=2) {
                    alert("Please select a row");
                } else {
                    const jsonBody = JSON.stringify({'key': "dataset", "data": JSON.stringify( chosenObject)});
                    const response = await fetch("/send-json/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: jsonBody,
                    });
                    console.log(response);
                    const data = await response.json();
                    window.location.href = link_path;
                }
            }
        </script>
    </head>
    <body>
        <h1>List of dataset</h1>
        <h2>Selected rows</h2>
        <button  onclick="submitRow('/')">
            Submit Row
        </button>
        <button  onclick="submitRow('/variable')">
            Find variables
        </button>
        <button  onclick="submitRow('/geography')">
            Find geography level
        </button>
        <div>
            <h2>Selected Dataset</h2>
        <div id="chosenData">
            {{ chosen_data|safe}}
            </div>
        </div>
        
    <div>
        <h2>Selected Variables</h2>
        {{variable|safe}}
    </div>
    <div>
        <h2>Selected Geography</h2>
        {{geography|safe}}
    </div>
        <p id="row-count"></p>
        <pre id="output"></pre>
        <div id="table-container" class="table-datasets">
            {% include 'table.html' %}
        </div>
    </body>
</html>
